"""
基本面分析Agent

专门负责公司基本面分析，包括财务报表分析、盈利能力、成长性等
"""

from typing import Any, Dict
from .base_agent import BaseAgent


class FundamentalAgent(BaseAgent):
    """基本面分析Agent"""
    
    def __init__(self, verbose: bool = True):
        super().__init__(
            name="基本面分析Agent",
            description="基本面分析",
            verbose=verbose
        )
    
    def get_result_key(self) -> str:
        """返回基本面分析结果的键名"""
        return "fundamental_analysis"
    
    def get_analysis_prompt(self, state: Dict[str, Any]) -> str:
        """生成基本面分析的提示词"""
        context = self.get_common_context(state)
        
        return f"""请分析{state['company_name']}（股票代码：{state['stock_code']}）的基本面情况。
{context}

请进行以下基本面分析：

## 分析任务
1. **公司基本信息获取**
   - 获取公司基本信息和行业背景
   - 了解主营业务和商业模式
   - 分析行业地位和竞争优势

2. **财务报表数据分析**
   - 获取最新财务报表数据（资产负债表、利润表、现金流量表）
   - 分析关键财务指标的变化趋势
   - 对比历史数据发现异常或亮点

3. **盈利能力分析**
   - 毛利率、营业利润率、净利率分析
   - ROE（净资产收益率）、ROA（资产收益率）分析
   - 盈利质量和可持续性评估

4. **成长能力分析**
   - 营业收入增长率分析（近3-5年）
   - 净利润增长率分析
   - 主营业务成长性和驱动因素

5. **运营效率分析**
   - 应收账款周转率、存货周转率
   - 总资产周转率分析
   - 营运资金管理效率

6. **偿债能力分析**
   - 资产负债率、流动比率、速动比率
   - 利息保障倍数
   - 债务结构和偿债风险评估

7. **分红政策分析**
   - 查询历史分红情况和股息率
   - 分红政策的稳定性和可持续性
   - 股东回报分析

## 分析要求
- 使用可用的工具获取实际数据进行分析，而不是基于假设
- 如果某些数据无法获取，请尝试使用不同的时间周期或其他工具组合
- 基于可用信息提供尽可能全面的分析
- 提供量化指标和定性判断相结合的分析结论
- 指出公司基本面的主要优势和风险点

## 输出格式
请按照以下结构输出分析结果：

### 基本面分析总结
[简要总结公司基本面整体状况]

### 财务指标分析
[详细的财务数据和指标分析]

### 盈利能力评估
[盈利能力相关分析]

### 成长性分析
[成长能力评估]

### 运营效率评估
[运营管理效率分析]

### 偿债能力评估
[财务风险和偿债能力分析]

### 分红政策分析
[股东回报和分红政策分析]

### 基本面投资价值结论
[基于基本面分析的投资价值判断和建议]

请确保分析客观、专业，基于实际数据得出结论。""" 