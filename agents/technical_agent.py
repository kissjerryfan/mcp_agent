"""
技术分析Agent

专门负责股票技术分析，包括价格趋势、技术指标、图表形态等
"""

from typing import Any, Dict
from .base_agent import BaseAgent


class TechnicalAgent(BaseAgent):
    """技术分析Agent"""
    
    def __init__(self):
        super().__init__(
            name="技术分析Agent",
            description="技术分析"
        )
    
    def get_result_key(self) -> str:
        """返回技术分析结果的键名"""
        return "technical_analysis"
    
    def get_analysis_prompt(self, state: Dict[str, Any]) -> str:
        """生成技术分析的提示词"""
        context = self.get_common_context(state)
        
        return f"""请分析{state['company_name']}（股票代码：{state['stock_code']}）的技术指标。
{context}

请进行以下技术分析：

## 分析任务
1. **基础数据获取**
   - 获取股票基本信息和最新价格
   - 获取历史K线数据（建议获取最近3-6个月的数据）
   - 获取成交量数据

2. **价格趋势分析**
   - 分析股价的主要趋势方向（上升、下降、横盘）
   - 识别重要的价格支撑位和阻力位
   - 分析价格波动的特征和周期性

3. **技术形态分析**
   - 识别经典技术形态（头肩顶、双顶双底、三角形等）
   - 分析形态的完整性和有效性
   - 判断形态突破的可能性和目标位

4. **成交量分析**
   - 分析价量关系和成交量变化趋势
   - 识别放量突破和缩量调整
   - 评估成交量对价格走势的确认作用

5. **移动平均线分析**
   - 计算和分析短期、中期、长期移动平均线
   - 分析均线的排列和支撑阻力作用
   - 判断均线系统的多空信号

6. **技术指标分析**
   - MACD指标：金叉死叉、背离、柱状线分析
   - RSI指标：超买超卖、背离分析
   - KDJ指标：金叉死叉、超买超卖分析
   - 布林带：价格位置、压力支撑分析

7. **短期走势判断**
   - 基于技术分析判断短期走势方向
   - 提供关键的买入卖出信号
   - 设定止损止盈位置建议

## 分析要求
- 使用可用的工具获取实际的价格和成交量数据
- 基于真实的K线图和技术指标进行分析
- 提供具体的数值和位置参考
- 结合多个技术指标进行综合判断
- 关注技术分析的时效性和实用性

## 输出格式
请按照以下结构输出分析结果：

### 技术分析概述
[股票当前技术面整体状况概述]

### 价格趋势分析
[主要趋势方向和关键价位分析]

### 技术形态识别
[当前技术形态和形态意义]

### 成交量分析
[价量关系和成交量特征分析]

### 移动平均线分析
[均线系统分析和信号判断]

### 主要技术指标分析
[MACD、RSI、KDJ、布林带等指标分析]

### 支撑阻力位分析
[关键支撑位和阻力位确定]

### 短期操作建议
[基于技术分析的短期操作策略和建议]

### 技术分析风险提示
[技术分析的局限性和注意事项]

请确保分析基于实际数据，提供具体的价位和时间参考。""" 